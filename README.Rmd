---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# btmembers

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

The Bundestag distributes [biographical and election data](https://www.bundestag.de/services/opendata/) on all members of the parliament since 1949. This data, however, can be difficult to work with because XML files store information in an arbitrary number of dimensions. btmembers downloads the file "Stammdaten aller Abgeordneten seit 1949 im XML-Format" from the Bundestag website and converts it to either (a) four data frames nested into a list (retaining all the information of the original XML file) or (b) a single, condensed data frame.

## Installation

You can install the development version of btmembers from GitHub with:

``` r
# install.packages("devtools")
devtools::install_github("jolyphil/btmembers")
```
## Usage

### Importing a list with all the information from the Bundestag

btmembers exports a single function: `import_members()`. By default, this function returns a list containing four data frames (`namen`, `bio`, `wp`, and `inst`), which together preserve all the information contained in the XML file provided by the Bundestag. 

```{r import-list}
library(btmembers)
members <- import_members()
summary(members)
```


#### Data frame `namen`

The data frame `namen` contains data on names of members of the Bundestag. Each row represents a name. Members can have multiple names (N~names~ > N~members~). 

```{r namen}
head(members$namen)
```


#### Data frame `bio`

The data frame `bio` contains biographical information on members. Each row represents a biographical entry. There is one entry by member (N~bio~ = N~members~). 

```{r bio}
head(members$bio)
```


#### Data frame `wp`

The data frame `wp` contains data on parliamentary terms served by members. Each row represents a member-term. Many members have served multiple terms (N~terms~ > N~members~).

```{r wp}
head(members$wp)
```


#### Data frame `inst`

The data frame `inst` contains records of functions occupied by members inside institutions of the Bundestag. Each row represents a member-term-function. Members might have had multiple functions during the same term (N~functions~ > N~terms~ > N~members~).

```{r inst}
head(members$inst)
```


### Importing a condensed data frame

Instead of importing a list with all the information from the Bundestag, `import_members()` can also load a condensed data frame. Each row corresponds to a member-term. Most of the information contained in the original data is preserved, except only the most recent name of the member is retained and functions are removed. A new column named `fraktion` is added to the data. `fraktion` is a recoded variable and refers to the faction the member spent most time in during a given parliamentary term.

```{r import-df}
members_df <- import_members(condensed_df = TRUE)
head(members_df[c("nachname", "vorname", "wp", "fraktion")])
```


### Joining data frames

You can join data frames by `id` (the members' identification numbers) or `id` _and_ `wp` (the parliamentary terms).

```{r join, message = FALSE}
library(dplyr)
library(magrittr)

members$namen %>%
  group_by(id) %>%
  slice_max(historie_von) %>% # keep most recent name
  ungroup() %>%
  left_join(members$bio, by = "id") %>%
  left_join(members$wp, by = "id") %>%
  left_join(members$inst, by = c("id", "wp")) %>%
  select(nachname, vorname, wp, ins_lang, mdbins_von, mdbins_bis) %>%
  head()
```


## CSV version

Not an R user? You can also download the different datasets as CSV files [here](csv/).


## Codebook

A codebook for the four data frames is available [here](codebook/codebook.pdf).


## Citation

```{r citation, echo = FALSE}
Sys.setenv(lang = "en_US")
citation("btmembers")
```

The package should be cited with the original source:

> Bundestag. (2021). _Stammdaten aller Abgeordneten seit 1949 im XML-Format_. https://www.bundestag.de/services/opendata
